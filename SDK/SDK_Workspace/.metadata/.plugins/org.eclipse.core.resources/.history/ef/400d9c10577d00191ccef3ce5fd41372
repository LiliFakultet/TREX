#include <stdlib.h>
#include "cactus.h"

Cactus cacti[MAX_CACTUS_COUNT];
static size_t cactus_count;

static const uint32_t cactus0[] = {
    0x11111111, 0x10000011, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1110001,
    0x11111111, 0x00000001, 0x1100000,
    0x10001111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000111, 0x00000001, 0x1100000,
    0x00000000, 0x00000000, 0x0000001,
    0x00000000, 0x00000000, 0x0000011,
    0x10000000, 0x00000000, 0x0000111,
    0x11000000, 0x00000000, 0x0001111,
    0x11100000, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111,
    0x11111111, 0x00000001, 0x1111111
};



static Sprite cactus_sprites[CACTUS_VARIANT_COUNT] = {{cactus0, 4, 32}};

void init_cacti() {
	int i;
	for (i = 0; i < MAX_CACTUS_COUNT; i++) {
		cacti[i].active = false;
	}

	cactus_count = 0;
}

void move_cacti() {
	int i;
	for (i = 0; i < MAX_CACTUS_COUNT; i++) {
		if (!cacti[i].active) {
			continue;
		}

		if (cacti[i].x > 0) {
			--(cacti[i].x);
		}
		else {
			cacti[i].active = false;
			--cactus_count;
		}
	}
}

void add_cactus() {
	int i;
	int available_index = -1;
	int variant;

	if (cactus_count == MAX_CACTUS_COUNT) {
		return;
	}

	for (i = 0; i < MAX_CACTUS_COUNT; i++) {
		if (!cacti[i].active) {
			available_index = i;
			break;
		}
	}

	variant = rand() % CACTUS_VARIANT_COUNT;

	cacti[available_index].active = true;
	cacti[available_index].sprite = &cactus_sprites[variant];
	cacti[available_index].x = 79 - cacti[available_index].sprite->width;
	cacti[available_index].y = 240;

	++cactus_count;
}

void show_cacti() {
	int i;
	for (i = 0; i < MAX_CACTUS_COUNT; i++) {
		if (cacti[i].active) {
			show_sprite(cacti[i].sprite, cacti[i].x, cacti[i].y);
		}
	}
}

void clear_cacti() {
	int i;
	for (i = 0; i < MAX_CACTUS_COUNT; i++) {
		if (cacti[i].active) {
			clear_sprite(cacti[i].sprite, cacti[i].x, cacti[i].y);
		}
	}
}

