#include "vga.h"
#include "xintc.h"


static XIntc xintc;
static Xuint32 cursor_position;

void init_vga_interrupt(void (*irq_handler)(void *)) {
	XStatus Status;
	XIo_Out32(XPAR_VGA_PERIPH_MEM_0_S_AXI_MEM0_BASEADDR + 0x54, 479);
	XIo_Out32(XPAR_VGA_PERIPH_MEM_0_S_AXI_MEM0_BASEADDR + 0x58, 1);

	//initialize interrupt controller
	Status = XIntc_Initialize (&xintc, XPAR_INTC_0_DEVICE_ID);
	if (Status != XST_SUCCESS)
		xil_printf ("\r\nInterrupt controller initialization failure");
	else
		xil_printf("\r\nInterrupt controller initialized");

	// Connect interrupt_handler
	Status = XIntc_Connect (&xintc, 0, (XInterruptHandler) irq_handler, NULL);

	if (Status != XST_SUCCESS)
		xil_printf ("\r\nRegistering MY_TIMER Interrupt Failed");
	else
		xil_printf("\r\nMY_TIMER Interrupt registered");

	//Start the interrupt controller in real mode
	Status = XIntc_Start(&xintc, XIN_REAL_MODE);

	//Enable interrupt controller
	XIntc_Enable (&xintc, 0);
	microblaze_enable_interrupts();
}
